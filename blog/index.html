<!DOCTYPE html>
<html lang="en">
<head>
    <title>Feature creep designer</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=0.8, minimum-scale=0.8" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link rel="stylesheet" href="http://lqez.github.io/blog/theme/css/main.css" type="text/css" />
        <link href="http://lqez.github.io/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Feature creep designer Atom Feed" />
                <link rel="apple-touch-icon" href="static/images/icons/fcd-57.png"/>
            <link rel="apple-touch-icon" sizes="72x72" href="static/images/icons/fcd-72.png"/>
            <link rel="apple-touch-icon" sizes="114x114" href="static/images/icons/fcd-114.png"/>
    
    <!--[if IE]>
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

    <!--[if lte IE 7]>
        <link rel="stylesheet" type="text/css" media="all" href="http://lqez.github.io/blog/css/ie.css"/>
        <script src="http://lqez.github.io/blog/js/IE8.js" type="text/javascript"></script><![endif]-->

    <!--[if lt IE 7]>
        <link rel="stylesheet" type="text/css" media="all" href="http://lqez.github.io/blog/css/ie6.css"/><![endif]-->
</head>
<body id="index" class="home">
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/ko_KR/all.js#xfbml=1&appId=465940413466203";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
    <header id="banner" class="body">
        <h1><a href="http://lqez.github.io/blog/">Feature creep designer </a></h1>
        <h2 id="greeting">Happy day.</h2>
    </header><!-- /#banner -->
            
            

                            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="http://lqez.github.io/blog/fool-upstart.html">Fool Upstart</a></h1> 
                    <footer class="post-info">
                <abbr class="published" title="2014-07-17T00:00:00">
                Thu 17 July 2014
        </abbr>

</footer><!-- /.post-info --><h1>Upstart</h1>
<p><a href="http://upstart.ubuntu.com/">Upstart</a>는 /sbin/init 를 대체하기 위한 우분투의 기본 서비스 관리자다.
다양한 서비스를 daemon 형태로 관리하고, 죽은 경우에 자동으로 다시 실행할 수 있는 등 편리한 기능을 갖추고 있다.</p>
<p>프로세스 ID를 받아 해당 프로세스가 잘 동작하는지 감시해야 하므로,
해당 서비스가 어떤 형태로 시작되는지 알고 있어야 정확한 프로세스 ID를 얻을 수 있다.
Upstart 설정 중, <a href="http://upstart.ubuntu.com/cookbook/#expect">expect stanza</a>가 이를 결정하며 일반적인 프로세스는 설정하지 않아도 동작하지만,
해당 프로세스가 fork 되어 동작하거나 daemonize 되는 경우, 별도의 값을 지정해야 정확한 ID 확인이 가능하다.
이 부분에 혼란을 겪은 사람이 꽤 많아, 홈페이지 에서 별도로 안내하고 있을 정도다.</p>
<ul>
<li><a href="http://upstart.ubuntu.com/cookbook/#implications-of-misspecifying-expect">6.13.5 Implications of Misspecifying expect</a></li>
</ul>
<h2>Symptom</h2>
<p>보통은 이 값을 잘못 설정한 경우에 서비스가 제대로 감시되지 않거나, 종료되지 않는 등의 문제가 생기는데
오늘은 해당 서비스를 재시작하면서 별다른 설정의 변경이 없었음에도 불구하고, 이상한 상태에 빠지고 말았다.</p>
<div class="codehilite"><pre><span class="err">$</span> <span class="n">initctl</span> <span class="n">list</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">flower</span>
<span class="n">one</span><span class="o">/</span><span class="n">flower</span> <span class="n">start</span><span class="o">/</span><span class="n">killed</span><span class="p">,</span> <span class="n">process</span> <span class="mi">14645</span>
</pre></div>


<p>이 상황에서는 <code>start</code> / <code>stop</code> 명령어가 전부 hang이 되어 서비스 재시작이나 종료가 불가능하다.
<code>start/killed</code> 로 표시되는 프로세스 ID를 <code>ps</code>로 찾아보면 당연히 없는 프로세스 ID다.
한참을 헤매다 혹시나 싶어 upstart configuration 파일을 복제하여 다른 이름으로 바꿨더니, 제대로 동작한다!</p>
<div class="codehilite"><pre><span class="err">$</span> <span class="n">initctl</span> <span class="n">list</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">flower</span>
<span class="n">one</span><span class="o">/</span><span class="n">flower</span> <span class="n">start</span><span class="o">/</span><span class="n">killed</span><span class="p">,</span> <span class="n">process</span> <span class="mi">14645</span>
<span class="n">one</span><span class="o">/</span><span class="n">flower_dup</span> <span class="n">start</span><span class="o">/</span><span class="n">running</span><span class="p">,</span> <span class="n">process</span> <span class="mi">17171</span>
</pre></div>


<h2>Solution</h2>
<p>시스템을 재시작하면 복구될 것 같았지만, 당장 재시작할 수 없는 프로덕션 시스템이라
혹시나 하여 구글링을 계속하다보니 누군가 만들어둔 루비 스크립트를 찾게 되었다.</p>
<ul>
<li><a href="https://github.com/ion1/workaround-upstart-snafu">https://github.com/ion1/workaround-upstart-snafu</a></li>
</ul>
<p>프로세스가 <code>start/killed</code> 또는 <code>stop/killed</code> 상태일 때 사용할 수 있는 이 스크립트는,</p>
<ol>
<li>포크하여 프로세스 A를 하나 생성한다.</li>
<li>프로세스 A에서 문제의 프로세스 ID를 받을 때까지 계속해서 자식 프로세스 B를 포크한다.</li>
<li>지정된 ID를 얻으면 프로세스 A, B를 모두 종료한다.</li>
<li>Upstart는 이것이 정상적인 프로세스 종료로 판단하고 혼란 상황에서 빠져나온다.</li>
</ol>
<p>우여곡절 끝에 문제 해결.</p>
<div class="codehilite"><pre><span class="err">$</span> <span class="n">initctl</span> <span class="n">list</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">one</span>
<span class="n">one</span><span class="o">/</span><span class="n">flower</span> <span class="n">start</span><span class="o">/</span><span class="n">running</span><span class="p">,</span> <span class="n">process</span> <span class="mi">14810</span>
</pre></div><script src="//platform.twitter.com/widgets.js" charset="utf-8"></script><footer class="post-info-footer">
                <p>
        In <a href="http://lqez.github.io/blog/category/2014-07.html">2014-07</a>. 
                </p>
        <p>tags: <a href="http://lqez.github.io/blog/tag/diary.html" class="tag">diary</a><a href="http://lqez.github.io/blog/tag/ubuntu.html" class="tag">ubuntu</a></p></footer><!-- /.post-info -->                                        <div class="fb-comments" data-href="http://lqez.github.io/blog/fool-upstart.html" data-width="0" data-num-posts="5"></div>
                                    </article>
                            </aside><!-- /#featured -->
                            <section id="content" class="body">
                    <ol id="posts-list" class="hfeed">
                                                

                 
                        <li><article class="hentry">    
                <header>
                    <h1 class="entry-title"><a href="http://lqez.github.io/blog/lie-makes-worse-career.html" rel="bookmark"
                           title="Permalink to Lie makes worse career">Lie makes worse career</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
                <abbr class="published" title="2014-07-16T00:00:00">
                Wed 16 July 2014
        </abbr>

</footer><!-- /.post-info -->                <p>구인 과정에서 있었던 불미스러운 일을 포스팅 하였으나,
이하와 같은 의견이 있어 당사자와 대화하고 내용을 수정하였습니다.</p>
<ul>
<li><a href="https://twitter.com/returned_momoko/status/489567277793017856">https://twitter.com/returned_momoko/status/489567277793017856</a></li>
<li><a href="https://twitter.com/RealKaracha/status/489576613537800192">https://twitter.com/RealKaracha/status/489576613537800192</a></li>
</ul>
<p>당사자와의 문제를 끌어내 확대 해석 가능하도록 만든 점에 대해 사과드립니다.
아래는 당사자와 대화한 내용을 동의하에 기록한 것입니다.</p>
<p><img alt="conv.png" src="./static/images/2014-07/conv.png" /></p><script src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
                <a class="readmore" href="http://lqez.github.io/blog/lie-makes-worse-career.html">read more</a>
                                </div><!-- /.entry-content -->
            </article></li>
                            

                 
                        <li><article class="hentry">    
                <header>
                    <h1 class="entry-title"><a href="http://lqez.github.io/blog/today-works.html" rel="bookmark"
                           title="Permalink to Today works">Today works</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
                <abbr class="published" title="2013-10-16T00:00:00">
                Wed 16 October 2013
        </abbr>

</footer><!-- /.post-info -->                <p>뭘 하고 사는지 괜히 바쁜것 같아, 하루 일과를 정리해보았다.</p>
<ul>
<li>집에서 출발, 회사까지 걸어서 출근하기.</li>
<li>신규 입사자 면담.</li>
<li>VPN 설정 수정.</li>
<li>사내 서버실에서 랜선 교체작업, 케이블 정리, 서버 설치.</li>
<li>사내 서버실 냉각 / 경보 장치 관련하여 짧은 미팅.</li>
<li>신규 API 서비스 코드 리뷰. </li>
<li>기존 API 서비스의 pagination 관련 토론.</li>
<li>N사와 3세대 프로젝터 ...</li></ul>
                <a class="readmore" href="http://lqez.github.io/blog/today-works.html">read more</a>
                                </div><!-- /.entry-content -->
            </article></li>
                            

                 
                        <li><article class="hentry">    
                <header>
                    <h1 class="entry-title"><a href="http://lqez.github.io/blog/happy-birthday-to-me-2013.html" rel="bookmark"
                           title="Permalink to Happy birthday to me, 2013">Happy birthday to me, 2013</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
                <abbr class="published" title="2013-08-28T00:00:00">
                Wed 28 August 2013
        </abbr>

</footer><!-- /.post-info -->                <p><img alt="A drawing on my birthday" src="./static/images/2013-08/birthday.jpg" /></p>
<p>언제부턴가 생일에 특별한 의미를 부여하거나, 챙겨서 뭘 하진 않게 되었다.
어차피 날짜라는 건 연속적인 시간을 인간의 기준에 맞춰 불연속적인 개념으로 부르는 것일 뿐이라고 생각한다.
하지만 오늘은 어쩐지 회사 창업 후 달라진 모습을 기록해보고 싶다.</p>
<hr />
<p>사실 거의 10년간 다니던 회사를 그만두고 지금의 일을 시작하는데 우아한 동기나 굳은 마음가짐이 있었던 건 아니다 ...</p>
                <a class="readmore" href="http://lqez.github.io/blog/happy-birthday-to-me-2013.html">read more</a>
                                </div><!-- /.entry-content -->
            </article></li>
                            

                 
                        <li><article class="hentry">    
                <header>
                    <h1 class="entry-title"><a href="http://lqez.github.io/blog/gittipcom-and-forkorea.html" rel="bookmark"
                           title="Permalink to gittip.com and /for/korea">gittip.com and /for/korea</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
                <abbr class="published" title="2013-05-14T00:00:00">
                Tue 14 May 2013
        </abbr>

</footer><!-- /.post-info -->                <p>얼마 전, <a href="http://www.kickstarter.com/projects/andrewgodwin/schema-migrations-for-django">Schema Migrations for Django</a> 라는 오픈소스 프로젝트 계획에 대한 모금 활동이 킥스타터에서 큰 성공을 거뒀다. 이제까지 오픈소스를 사용하면서 개발한 이들에게 고마움을 표시하는 방법은 해당 프로젝트를 열심히 사용하며, 버그 제보, 번역, 기능 추가 또는 사용기 발표 정도 밖에 없다고 생각했는데, '금전적인' 후원도 가능하다는 것을 알게 되었다.</p>
<h2>Gittip</h2>
<p><img alt="gittip.png" src="./static/images/2013-05/gittip.png" /></p>
<p><a href="https://www.gittip.com">https://www ...</a></p>
                <a class="readmore" href="http://lqez.github.io/blog/gittipcom-and-forkorea.html">read more</a>
                                </div><!-- /.entry-content -->
            </article></li>
                            </ol><!-- /#posts-list -->
                            <p class="paginator">
        Page 1 / 2
            <a href="http://lqez.github.io/blog/index2.html">&raquo;</a>
    </p>
                        </section><!-- /#content -->
                <section id="extras" class="body">
            </section><!-- /#extras -->

    <footer id="contentinfo" class="body">
    <!--
        <nav><ul>
                                                    <li ><a href="http://lqez.github.io/blog/category/2013-02.html">2013-02</a></li>
                    <li ><a href="http://lqez.github.io/blog/category/2013-04.html">2013-04</a></li>
                    <li ><a href="http://lqez.github.io/blog/category/2013-05.html">2013-05</a></li>
                    <li ><a href="http://lqez.github.io/blog/category/2013-08.html">2013-08</a></li>
                    <li ><a href="http://lqez.github.io/blog/category/2013-10.html">2013-10</a></li>
                    <li ><a href="http://lqez.github.io/blog/category/2014-07.html">2014-07</a></li>
                    <li ><a href="http://lqez.github.io/blog/category/uncategorized.html">Uncategorized</a></li>
                </ul></nav>
        -->
        <address id="about" class="vcard body">
        Published by <a href="http://getpelican.com/">Pelican</a> / <a href="http://python.org">Python</a>.
        <p id="theme"><a href="https://github.com/lqez/42signals-pelican-theme">42 signals theme by lqez</a></p>
        </address><!-- /#about -->
    </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37711911-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
</body>
<script language="javascript">
var weekday = new Array("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday");
var dayOfWeek = weekday[new Date().getDay()];
document.getElementById('greeting').innerHTML = "Happy " + dayOfWeek + ".";
</script>
</html>